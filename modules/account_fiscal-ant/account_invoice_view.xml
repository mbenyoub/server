<?xml version="1.0"?>
<openerp>
    <data>
    
        <!-- Cambia secuencia de menus de factura -->
        <menuitem id="account.menu_action_invoice_tree1" action="account.action_invoice_tree1" name="Facturas de Cliente" parent="account.menu_finance_receivables" sequence="5"/>
        <menuitem id="account.menu_action_invoice_tree2" action="account.action_invoice_tree2" name="Facturas de Proveedor" parent="account.menu_finance_payables" sequence="5"/>
    
<!--
        Modifica action de facturas de cliente
-->
        <record id="account.action_invoice_tree1" model="ir.actions.act_window">
            <field name="name">Facturas del cliente</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('type','=','out_invoice'),('invoice_asset','=',False),('debit_note','=',False)]</field>
            <field name="context">{'default_type':'out_invoice', 'type':'out_invoice', 'debit_note':False, 'journal_type': 'sale'}</field>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                Pulse para crear una factura a un cliente.
                </p><p>
                La facturacion electronica de OpenERP permite facilitar y acelerar
                el pago de los clientes. Su cliente recibe la factura por correo electronico
                y puede pagarla en linea o importarla a su propio sistema.
                </p><p>
                Las discusiones con su cliente se muestran automaticamente al final de cada factura.
                </p>
            </field>
        </record>

<!--
        Detalle de Factura cliente
-->
        <!--  Filtros  -->
        <record id="account_invoice_line_filter" model="ir.ui.view">
            <field name="name">account.invoice.line.select</field>
            <field name="model">account.invoice.line</field>
            <field name="arch" type="xml">
                <search string="Buscar Tipo">
                    <field name="name" filter_domain="['|','|',('name','ilike',self),('product_id','ilike',self),('invoice_id','ilike',self)]"/>
                    <field name="product_id"/>
                    <field name="partner_id"/>
                    <field name="account_id"/>
                    <field name="invoice_line_tax_id" />
                    <field name="quantity"/>
                    <field name="uos_id"/>
                    <field name="price_unit"/>
                    <field name="discount"/>
                    <field name="currency_id"/>
                    <field name="date_invoice"/>
                    <field name="state"/>
                    <field name="journal_id"/>
                    <field name="period_id"/>
                    <field name="invoice_id"/>
                    <field name="user_id"/>
                    <field name="account_tax"/>
                    <filter string="Mis Facturas" domain="[('user_id','=',uid)]" context="{}"/>
                    <separator/>
                    <filter string="Mas de un producto" domain="[('quantity','>',1)]" context="{}"/>
                    <filter string="Tiene descuento" domain="[('discount','&gt;',0)]" context="{}"/>
                    <filter string="No tiene descuento" domain="[('discount','&lt;=',0)]" context="{}"/>
                    <separator/>
                    <filter string="Facturas borrador" domain="[('state','=','draft')]" context="{}"/>
                    <filter string="Facturas validadas" domain="[('state','=','open')]" context="{}"/>
                    <filter string="Facturas pagadas" domain="[('state','=','paid')]" context="{}"/>
                    <separator/>
                    <group expand="0" string="Group By...">
                        <filter string="Factura" context="{'group_by': 'invoice_id'}"/>
                        <filter string="Cliente" context="{'group_by': 'partner_id'}"/>
                        <filter string="Comercial" context="{'group_by': 'user_id'}"/>
                        <filter string="Producto" context="{'group_by': 'product_id'}"/>
                        <filter string="Cuenta" context="{'group_by': 'account_id'}"/>
                        <filter string="Cantidad" context="{'group_by': 'quantity'}"/>
                        <filter string="Unidad Medida" context="{'group_by': 'uos_id'}"/>
                        <filter string="Moneda" context="{'group_by': 'currency_id'}"/>
                        <filter string="Diario" context="{'group_by': 'journal_id'}"/>
                        <filter string="Periodo" context="{'group_by': 'period_id'}"/>
                        <filter string="Impuesto" context="{'group_by': 'account_tax'}"/>
                        <separator />
                    </group>
               </search>
            </field>
        </record>
        
        <!-- Vista lista -->
        <record id="account_invoice_line_tree_view" model="ir.ui.view">
            <field name="name">account.invoice.line.tree</field>
            <field name="model">account.invoice.line</field>
            <field name="arch" type="xml">
                <tree string="Detalle Factura" edit="0" create="0" delete="0">
                    <field name="invoice_id" string="Factura"/>
                    <field name="invoice_number" invisible="1"/>
                    <field name="partner_id" />
                    <field name="product_id"/>
                    <field name="name"/>
                    <field name="company_id" invisible="1"/>
                    <field name="account_id" groups="account.group_account_user"/>
                    <field name="account_analytic_id" groups="analytic.group_analytic_accounting" domain="[('type','!=','view'), ('company_id', '=', parent.company_id)]"/>
                    <field name="quantity"/>
                    <field name="uos_id" groups="product.group_uom" />
                    <field name="price_unit"/>
                    <field name="discount" groups="sale.group_discount_per_so_line"/>
                    <field name="invoice_line_tax_id" widget="many2many_tags" context="{'type':parent.type}" domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]"/>
                    <field name="price_subtotal"/>
                    <field name="currency_id"/>
                    <field name="date_invoice"/>
                    <field name="state"/>
                    <field name="journal_id" invisible="1"/>
                    <field name="period_id" invisible="1"/>
                    <field name="user_id" invisible="1"/>
                    <field name="type_invoice" invisible="1"/>
                    <field name="account_tax" invisible="1"/>
                    <button name="action_redirect_invoice" help="Ir a factura" string="" class="oe_edit_only" type="object" icon="gtk-redo"/>
                </tree>
            </field>
        </record>
        
        <!-- Action -->
        <record id="action_account_invoice_line_view1" model="ir.actions.act_window">
            <field name="name">Detalle de Factura Cliente</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">account.invoice.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="context">{'default_type':'out_invoice', 'type_invoice':'out_invoice', 'journal_type': 'sale'}</field>
            <field name="domain">[('type_invoice','=','out_invoice')]</field>
            <field name="search_view_id" ref="account_invoice_line_filter"/>
            <field name="view_id" ref="account_invoice_line_tree_view"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Informacion sobre el detalle de Facturas
                </p>
            </field>
        </record>

        <menuitem action="action_account_invoice_line_view1" name="Detalle de Facturas Cliente" id="menu_account_invoice_line_customer" parent="account.menu_finance_receivables" sequence="8"/>
    
<!--
        Detalle de Factura proveedor
-->
        <!--  Filtros  -->
        <record id="account_invoice_line_filter2" model="ir.ui.view">
            <field name="name">account.invoice.line.select</field>
            <field name="model">account.invoice.line</field>
            <field name="arch" type="xml">
                <search string="Buscar Tipo">
                    <field name="name" filter_domain="['|','|',('name','ilike',self),('product_id','ilike',self),('invoice_id','ilike',self)]"/>
                    <field name="product_id"/>
                    <field name="partner_id" />
                    <field name="account_id"/>
                    <field name="invoice_line_tax_id" />
                    <field name="quantity"/>
                    <field name="uos_id"/>
                    <field name="price_unit"/>
                    <field name="discount"/>
                    <field name="currency_id"/>
                    <field name="date_invoice"/>
                    <field name="state"/>
                    <field name="journal_id"/>
                    <field name="period_id"/>
                    <field name="invoice_id"/>
                    <field name="user_id"/>
                    <field name="asset_category_id"/>
                    <field name="asset_group"/>
                    <filter string="Mis Facturas" domain="[('user_id','=',uid)]" context="{}"/>
                    <separator/>
                    <filter string="Mas de un producto" domain="[('quantity','>',1)]" context="{}"/>
                    <filter string="Tiene descuento" domain="[('discount','&gt;',0)]" context="{}"/>
                    <filter string="No tiene descuento" domain="[('discount','&lt;=',0)]" context="{}"/>
                    <separator/>
                    <filter string="Facturas borrador" domain="[('state','=','draft')]" context="{}"/>
                    <filter string="Facturas validadas" domain="[('state','=','open')]" context="{}"/>
                    <filter string="Facturas pagadas" domain="[('state','=','paid')]" context="{}"/>
                    <separator/>
                    <filter string="Activos Agrupados" domain="[('asset_category_id','!=',False),('asset_group','=',True)]" context="{}"/>
                    <filter string="Activos no Agrupados" domain="[('asset_category_id','!=',False),('asset_group','=',False)]" context="{}"/>
                    <filter string="No es Activo" domain="[('asset_category_id','=',False)]" context="{}"/>
                    <separator/>
                    <group expand="0" string="Group By...">
                        <filter string="Factura" context="{'group_by': 'invoice_id'}"/>
                        <filter string="Cliente" context="{'group_by': 'partner_id'}"/>
                        <filter string="Comercial" context="{'group_by': 'user_id'}"/>
                        <filter string="Producto" context="{'group_by': 'product_id'}"/>
                        <filter string="Cuenta" context="{'group_by': 'account_id'}"/>
                        <filter string="Cantidad" context="{'group_by': 'quantity'}"/>
                        <filter string="Unidad Medida" context="{'group_by': 'uos_id'}"/>
                        <filter string="Moneda" context="{'group_by': 'currency_id'}"/>
                        <filter string="Diario" context="{'group_by': 'journal_id'}"/>
                        <filter string="Periodo" context="{'group_by': 'period_id'}"/>
                        <separator/>
                        <filter string="Categoria Activo" context="{'group_by': 'asset_category_id'}"/>
                        <separator />
                    </group>
               </search>
            </field>
        </record>
        
        <!-- Vista lista -->
        <record id="account_invoice_line_tree_view2" model="ir.ui.view">
            <field name="name">account.invoice.line.tree</field>
            <field name="model">account.invoice.line</field>
            <field name="arch" type="xml">
                <tree string="Detalle Factura" edit="0" create="0" delete="0">
                    <field name="invoice_id" string="Factura"/>
                    <field name="invoice_number" invisible="1"/>
                    <field name="partner_id" />
                    <field name="product_id"/>
                    <field name="name"/>
                    <field name="company_id" invisible="1"/>
                    <field name="account_id" groups="account.group_account_user"/>
                    <field name="account_analytic_id" groups="analytic.group_analytic_accounting" domain="[('type','!=','view'), ('company_id', '=', parent.company_id)]"/>
                    <field name="asset_category_id"/>
                    <field name="asset_group" invisible="1"/>
                    <field name="quantity"/>
                    <field name="uos_id" groups="product.group_uom" />
                    <field name="price_unit"/>
                    <field name="discount" groups="sale.group_discount_per_so_line"/>
                    <field name="invoice_line_tax_id" widget="many2many_tags" context="{'type':parent.type}" domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]"/>
                    <field name="price_subtotal"/>
                    <field name="currency_id"/>
                    <field name="date_invoice"/>
                    <field name="state"/>
                    <field name="journal_id" invisible="1"/>
                    <field name="period_id" invisible="1"/>
                    <field name="user_id" invisible="1"/>
                    <field name="type_invoice" invisible="1"/>
                    <button name="action_redirect_invoice_supplier" help="Ir a factura" string="" class="oe_edit_only" type="object" icon="gtk-redo"/>
                </tree>
            </field>
        </record>
        
        <!-- Action -->
        <record id="action_account_invoice_line_view2" model="ir.actions.act_window">
            <field name="name">Detalle de Factura Proveedor</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">account.invoice.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="context">{'default_type': 'in_invoice', 'type_invoice': 'in_invoice', 'journal_type': 'purchase', 'default_invoice_expense':True}</field>
            <field name="domain">[('type_invoice','=','in_invoice'),('invoice_expense','=',True)]</field>
            <field name="search_view_id" ref="account_invoice_line_filter2"/>
            <field name="view_id" ref="account_invoice_line_tree_view2"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Informacion sobre el detalle de Facturas
                </p>
            </field>
        </record>

        <menuitem action="action_account_invoice_line_view2" name="Detalle de Facturas Proveedor" id="menu_account_invoice_line_supplier" parent="account.menu_finance_payables" sequence="8"/>
    
<!--
        Factura
-->
    
        <!-- Modificacion de search -->
        <record model="ir.ui.view" id="view_account_invoice_filter_inherit">
            <field name="name">account.invoice.search.inherit</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.view_account_invoice_filter" />
            <field name="priority" eval="18"/>
            <field name="arch" type="xml">
                <field name="number" position="after">
                    <field name="account_id"/>
                    <field name="currency_id"/>
                    <field name="date_cancel"/>
                </field>
                <filter string="Due Date" position="after" >
                    <filter string="Divisa" name="group_currency_id" icon="terp-accessories-archiver-minus" domain="[]" context="{'group_by':'currency_id'}"/>
                    <filter string="Cuenta" name="group_account_id" icon="terp-accessories-archiver-minus" domain="[]" context="{'group_by':'account_id'}"/>
                    <filter string="Fecha cancelacion" name="group_account_id" icon="terp-accessories-archiver-minus" domain="[('state','=','cancel')]" context="{'group_by':'date_cancel'}"/>
                </filter>
            </field>
        </record>
        
        <record model="ir.ui.view" id="invoice_tree_view_inherit">
            <field name="name">account.invoice.tree.inherit</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_tree" />
            <field name="priority" eval="18"/>
            <field name="arch" type="xml">
                <field name="state" position="after">
                    <field name="account_id" invisible="1"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="date_cancel" invisible="1"/>
                </field>
            </field>
        </record>
        
        <!-- Modificacion de la vista formulario -->
        <record model="ir.ui.view" id="invoice_form_inherit">
            <field name="name">account.invoice.form.inherit</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_form" />
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <button name="invoice_print" position="after">
                    <button name="action_invoice_sent2" type="object" string="Send by Email" attrs="{'invisible':[('state', '!=', 'paid')]}" groups="base.group_user"/>
                    <button name="invoice_print" string="Imprimir" type="object" attrs="{'invisible':[('state', '!=', 'paid')]}" groups="base.group_user"/>
                </button>
                <field name="move_id" position="after">
                    <field name="move_id_cancel"  attrs="{'invisible': ['|',('state','!=','cancel'),('move_id_cancel','=',False)]}"/>
                    <field name="ref_invoice_cancel" readonly="1" attrs="{'invisible': ['|',('state','!=','cancel'),('move_id_cancel','=',False)]}"/>
                </field>
                <button name="invoice_cancel" position="attributes">
                    <attribute name="invisible">1</attribute>
                </button>
                <button name="invoice_cancel" position="after">
                     <button name="action_cancel_wizard" states="proforma2,open" string="Cancelar Factura" type="object"/>
                </button>
                <button name="action_cancel_draft" position="replace" />
                <field name="currency_id" position="after">
                    <field name="apply_deduction_sale" invisible="1" />
                </field>
                <notebook position="inside">
                    <page string="Ingreso Acumulado" attrs="{'invisible': [('apply_deduction_sale','=',False)]}">
                        <field name="deduction_ids" >
                            <tree string="Deducciones">
                                <field name="name"/>
                                <field name="amount" sum="Total deducciones"/>
                                <field name="period_id"/>
                                <field name="category_id"/>
                                <field name="date"/>
                                <field name="voucher_id" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
                <xpath expr="//field[@name='tax_line']/tree/field[@name='amount']" position="after">
                    <field name="tax_code_id" />
                </xpath>
                <field name="date_invoice" position="after">
                    <field name="date_invoice_cancel" readonly="1" attrs="{'invisible': ['|',('state','!=','cancel'),('move_id_cancel','=',False)]}" />
                </field>
                <field name="tax_line" position="after">
                    <group attrs="{'invisible':['|',('type','not in',['out_invoice']),('state','=','draft')]}">
                        <field name="picking_ids" readonly="1" context="{'default_invoice_id': active_id, 'form_view_ref': 'stock.view_picking_form'}">
                            <tree>
                                <field name="name"/>
                                <field name="backorder_id"/>
                                <field name="date"/>
                                <field name="min_date"/>
                                <field name="type"/>
                                <field name="state"/>
                            </tree>
                        </field>
                    </group>
                </field>
                <field name="date_due" position="after">
                    <field name="apply_stock" invisible="1"/>
                    <field name="shipped" invisible="0"/>
                </field>
                <field name="date_due" position="attributes">
                    <attrubute name="attrs">{'readonly':[('state','in',['paid','cancel','repaid'])]}</attrubute>
                    <attrubute name="modifiers">{'readonly':[('state','in',['paid','cancel','repaid'])]}</attrubute>
                </field>
                <button name="invoice_pay_customer" position="before">
                    <button name="action_ship_create" string="Enviar productos" type="object" class="oe_highlight" attrs="{'invisible':['|',('apply_stock','=',False),'|',('shipped','=',True),('state','not in',['open','paid'])]}"/>
                </button>
                <xpath expr="//field[@name='payment_ids']/tree/field[@name='currency_id']" position="after">
                    <button name="action_view_move" string="" type="object" icon="gtk-redo"/>
                </xpath>
                <button name="action_ship_create" position="attributes">
                    <attribute name="attrs">{'invisible':['|',('apply_stock','=',False),'|','|',('shipped','=',True),('state','not in',['open','paid']),('global_invoice','=',True)]}</attribute>
                </button>
            </field>
        </record>
    
        <!-- Modificacion de la vista formulario -->
        <record model="ir.ui.view" id="invoice_supplier_form_inherit">
            <field name="name">account.invoice.supplier.form.inherit</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_supplier_form" />
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <field name="move_id" position="after">
                    <field name="move_id_cancel"  attrs="{'invisible': ['|',('state','!=','cancel'),('move_id_cancel','=',False)]}"/>
                    <field name="ref_invoice_cancel" readonly="1" attrs="{'invisible': ['|',('state','!=','cancel'),('move_id_cancel','=',False)]}"/>
                </field>
                <button name="invoice_cancel" position="attributes">
                    <attribute name="invisible">1</attribute>
                </button>
                <button name="invoice_cancel" position="after">
                     <button name="action_cancel_wizard" states="proforma2,open" string="Cancelar Factura" type="object"/>
                </button>
                <field name="currency_id" position="after">
                    <field name="apply_deduction" invisible="1" />
                    <field name="title" invisible="1" />
                </field>
                <button name="action_cancel_draft" position="replace" />
                <notebook position="inside">
                    <page string="Deducciones" attrs="{'invisible': [('title','!=','title_4'),('apply_deduction','=',False)]}">
                        <field name="deduction_ids" >
                            <tree string="Deducciones">
                                <field name="name"/>
                                <field name="amount" sum="Total deducciones"/>
                                <field name="period_id"/>
                                <field name="category_id"/>
                                <field name="date"/>
                                <field name="voucher_id" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
                <xpath expr="//field[@name='tax_line']/tree/field[@name='amount']" position="after">
                    <field name="tax_code_id" />
                </xpath>
                <field name="date_invoice" position="after">
                    <field name="date_invoice_cancel" readonly="1" attrs="{'invisible': ['|',('state','!=','cancel'),('move_id_cancel','=',False)]}" />
                </field>
                <xpath expr="/form/sheet/notebook/page[@string='Other Info']" position="inside">
                    <group attrs="{'invisible':['|',('type','not in',['in_invoice']),('state','=','draft')]}">
                        <field name="picking_ids" readonly="1" context="{'default_invoice_id': active_id, 'form_view_ref': 'stock.view_picking_form'}">
                            <tree>
                                <field name="name"/>
                                <field name="backorder_id"/>
                                <field name="date"/>
                                <field name="min_date"/>
                                <field name="type"/>
                                <field name="state"/>
                            </tree>
                        </field>
                    </group>
                </xpath>
                <field name="payment_term" position="after">
                    <field name="apply_stock" invisible="1"/>
                    <field name="shipped" invisible="0"/>
                </field>
                <button name="invoice_pay_customer" position="before">
                    <button name="action_ship_create" string="Recibir productos" type="object" class="oe_highlight" attrs="{'invisible':['|',('apply_stock','=',False),'|',('shipped','=',True),('state','not in',['open','paid'])]}"/>
                </button>
                <field name="journal_id" position="before">
                    <field name="shop_id"/>
                </field>
                <xpath expr="//field[@name='payment_ids']/tree/field[@name='currency_id']" position="after">
                    <button name="action_view_move" string="" type="object" icon="gtk-redo"/>
                </xpath>
                <xpath expr="//field[@name='tax_line']/tree/field[@name='tax_code_id']" position="after">
                    <field name="manual" />
                </xpath>
                <xpath expr="//field[@name='tax_line']/tree/field[@name='base']" position="attributes">
                    <attribute name="readonly">0</attribute>
                </xpath>
            </field>
        </record>
        
        <!-- View Form - Facturacion Notas de credito -->
        <record id="l10n_mx_facturae_refund.invoice_refund_form" model="ir.ui.view">
            <field name="name">account.invoice.refund.form</field>
            <field name="model">account.invoice</field>
            <field name="arch" type="xml">
                <form string="Invoice"  create="0" version="7.0">
                <header>
                    <button name="action_invoice_sent2" type="object" string="Send by Email" attrs="{'invisible':['|',('sent','=',True), ('state', '!=', 'open')]}" groups="base.group_user"/>
                    <button name="invoice_print" string="Imprimir" type="object" attrs="{'invisible':['|',('sent','=',True), ('state', '!=', 'open')]}" groups="base.group_user"/>
                    <button name="action_invoice_sent2" type="object" string="Send by Email" attrs="{'invisible':['|',('sent','=',False), ('state', '!=', 'open')]}" groups="base.group_user"/>
                    <button name="invoice_print" string="Imprimir" type="object" attrs="{'invisible':['|',('sent','=',False), ('state', '!=', 'open')]}" groups="base.group_user"/>
                    <button name="action_invoice_sent2" type="object" string="Send by Email" attrs="{'invisible':[('state', '!=', 'paid')]}" groups="base.group_user"/>
                    <button name="invoice_print" string="Imprimir" type="object" attrs="{'invisible':[('state', '!=', 'paid')]}" groups="base.group_user"/>
                    <button name="invoice_open" states="draft" string="Validate" class="oe_highlight" groups="base.group_user"/>
                    <button name="invoice_open" states="proforma2" string="Validate" groups="base.group_user"/>
                    
                    <button name="action_invoice_open_and_concile" type="object" string="Validar y Saldar" attrs="{'invisible': ['|',('state','not in',['draft']),('filter_refund','in',['none'])]}" class="oe_highlight" groups="base.group_user"/>
                    <button name="action_invoice_open_and_concile" type="object" string="Validar y Saldar" attrs="{'invisible': ['|',('state','not in',['proforma2']),('filter_refund','in',['none'])]}" groups="base.group_user"/>
                    
                    <button name="action_invoice_concile" type="object" string="Saldar con factura" groups="base.group_user" attrs="{'invisible': ['|',('state','!=','open'),('invoice_id','=',False)]}"/>
                    
                    <button name="invoice_pay_customer" type="object" string="Generar devolucion"
                        attrs="{'invisible': ['|', ('state','!=','open'), ('sent','=',True)]}" groups="base.group_user"/>
                    <button name="invoice_pay_customer" type="object" string="Generar devolucion"
                        attrs="{'invisible': ['|', ('state','!=','open'), ('sent','=',False)]}" class="oe_highlight" groups="base.group_user"/>
                    
                    <button name="action_ship_create" string="Enviar productos" type="object" class="oe_highlight" attrs="{'invisible':['|',('apply_stock','=',False),'|',('shipped','=',True),('state','not in',['open','paid'])]}"/>
                    
                    <button name="invoice_proforma2" states="draft" string="PRO-FORMA" groups="account.group_proforma_invoices"/>
                    <button name="%(account.action_account_invoice_refund)d" type='action' invisible="1" string='Generar Nota de credito' states='open,proforma2,paid' groups="base.group_user"/>
                    <button name="invoice_cancel" states="draft,proforma2,open" string="Cancel Invoice" groups="base.group_no_one"/>
                    <button name="action_cancel_draft" states="cancel" string="Reset to Draft" type="object" groups="base.group_user"/>
                    <button name='%(account.action_account_state_open)d' type='action' string='Re-Open' groups="account.group_account_invoice" attrs="{'invisible':['|', ('state','&lt;&gt;','paid'), ('reconciled', '=', True)]}" help="This button only appears when the state of the invoice is 'paid' (showing that it has been fully reconciled) and auto-computed boolean 'reconciled' is False (depicting that it's not the case anymore). In other words, the invoice has been dereconciled and it does not fit anymore the 'paid' state. You should press this button to re-open it and let it continue its normal process after having resolved the eventual exceptions it may have created."/>
                    <!--button name="%(account.account_invoices)d" string="print Invoice" type="action" states="open,paid,proforma,sale,proforma2"/-->
                    <field name="state" widget="statusbar" nolabel="1" statusbar_visible="draft,open,paid" statusbar_colors='{"proforma":"blue","proforma2":"blue"}'/>
                </header>
                <sheet string="Invoice">
                    <h1>
                        <label string="Nota Credito Borrador " attrs="{'invisible': ['|',('state','not in',('draft',)), ('type','&lt;&gt;','out_refund')]}"/>
                        <label string="Nota Credito " attrs="{'invisible': ['|',('state','in',('draft','proforma','proforma2')), ('type','&lt;&gt;','out_refund')]}"/>
                        <field name="number" readonly="1" class="oe_inline"/>
                    </h1>
                    <field name="type" invisible="1"/>
                    <group>
                        <group>
                            <field string="Customer" name="partner_id"
                                on_change="onchange_partner_id(type,partner_id,date_invoice,payment_term, partner_bank_id,company_id)"
                                groups="base.group_user" context="{'search_default_customer':1, 'show_address': 1}"
                                options='{"always_reload": True}'
                                domain="[('customer', '=', True)]"/>
                            <field name="fiscal_position" invisible="1"/>
                            <field name="debit_note" invisible="1"/>
                        </group>
                        <group>
                            <field name="date_invoice"/>
                            <field name="invoice_datetime"/>
                            <field name="shop_id"/>
                            <field name="journal_id" groups="account.group_account_user"
                                on_change="onchange_journal_id(journal_id, context)" widget="selection"/>
                            <field domain="[('company_id', '=', company_id),('type','=', 'receivable')]"
                                name="account_id" groups="account.group_account_user"/>
                            <label for="currency_id" groups="base.group_multi_currency"/>
                            <div groups="base.group_multi_currency">
                                <field name="currency_id" class="oe_inline"/>
                                <!-- note fp: I don't think we need this feature ?
                                <button name="%(account.action_account_change_currency)d" type="action"
                                  icon="terp-stock_effects-object-colorize"
                                  attrs="{'invisible':[('state','!=','draft')]}"
                                  groups="account.group_account_user"/> -->
                            </div>
                        </group>
                    </group>
                    <field name="sent" invisible="1"/>
                    <notebook colspan="4">
                        <page string="Invoice Lines">
                            <button name="action_create_line" string="Agregar" class="oe_highlight"  attrs="{'invisible':['|',('filter_refund','!=','none'),('state','in',['open','cancel','paid'])]}" type="object" help="Agregar nuevo concepto a la factura"/>
                            <field name="invoice_line" nolabel="1" widget="one2many_list" context="{'type': type, 'state': state}">
                                <tree string="Invoice Lines" editable="bottom" create="0" delete="0">
                                    <field name="product_id" attrs="{'readonly': [('filter_refund','not in',['none'])]}"
                                           on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, context, parent.company_id)"/>
                                    <field name="name" attrs="{'readonly': [('filter_refund','not in',['none'])]}"/>
                                    <field name="company_id" invisible="1"/>
                                    <field name="account_id" groups="account.group_account_user" attrs="{'readonly': [('filter_refund','not in',['none'])]}"
                                           domain="[('company_id', '=', parent.company_id), ('journal_id', '=', parent.journal_id), ('type', '=', 'other')]" on_change="onchange_account_id(product_id, parent.partner_id, parent.type, parent.fiscal_position,account_id)"/>
                                    <field name="account_analytic_id" attrs="{'readonly': [('filter_refund','not in',['none'])]}"
                                           groups="analytic.group_analytic_accounting" domain="[('type','!=','view'), ('company_id', '=', parent.company_id)]"/>
                                <field name="quantity" on_change="onchange_edit_refund(filter_refund,quantity,quantity_refund,discount,context)" attrs="{'readonly': [('edit_refund','not in',['all','dev_desc','dev'])]}"/>
                                    <field name="uos_id" groups="product.group_uom" attrs="{'readonly': [('filter_refund','not in',['none'])]}"
                                           on_change="uos_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, context, parent.company_id)"/>
                                    <field name="price_unit" attrs="{'readonly': [('filter_refund','not in',['none'])]}"/>
                                <field name="discount" on_change="onchange_edit_refund(filter_refund,quantity,quantity_refund,discount,context)" attrs="{'readonly': [('edit_refund','not in',['all','dev_desc','desc'])]}" groups="sale.group_discount_per_so_line"/>
                                    <field name="invoice_line_tax_id" widget="many2many_tags" attrs="{'readonly': [('filter_refund','not in',['none'])]}"
                                           context="{'type':parent.type}" domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]"/>
                                    <field name="price_subtotal"/>
                                    <field name="filter_refund" invisible="1"/>
                                    <field name="line_id_ref" invisible="1"/>
                                    <field name="quantity_refund" invisible="1"/>
                                    <field name="discount_refund" invisible="1"/>
                                    <field name="edit_refund" invisible="1"/>
                                    <field name="inv_state" invisible="1"/>
                                    <button name="action_delete_line" string="" class="oe_edit_only" type="object" icon="gtk-cancel" attrs="{'invisible':['|',('filter_refund','!=','none'),('inv_state','in',['open','cancel','paid'])]}"/>
                                </tree>
                            </field>
                            <group class="oe_subtotal_footer oe_right">
                                <field name="amount_untaxed" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <div>
                                    <label for="amount_tax"/>
                                    <button name="button_reset_taxes" states="draft,proforma2"
                                        string="(update)" class="oe_link oe_edit_only"
                                        type="object" help="Recompute taxes and total"/>
                                </div>
                                <field name="amount_tax" nolabel="1" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="amount_total" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="residual" groups="account.group_account_user" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="reconciled" invisible="1"/>
                            </group>
                            <group>
                                    <field name="payment_term" class="oe_inline" invisible="1"/>
                                    <field name="rate" readonly="1"/>
                            </group>
                            <div class="oe_clear">
                                <label for="comment"/>
                            </div>
                            <field name="comment" class="oe_inline" placeholder="Additional notes..."/>
                        </page>
                        <page string="Other Info">
                            <group col="4">
                                <group>
                                    <field name="company_id" on_change="onchange_company_id(company_id,partner_id,type,invoice_line,currency_id)" widget="selection" groups="base.group_multi_company"/>
                                    <field name="user_id" groups="base.group_user"/>
                                    <field domain="[('partner_id.ref_companies', 'in', [company_id])]" name="partner_bank_id"/>
                                    <field name="period_id" domain="[('state', '=', 'draft'), ('company_id', '=', company_id)]"
                                        groups="account.group_account_manager"
                                        string="Accounting Period"
                                        placeholder="force period"/>
                                    <field name="filter_refund" readonly="1"/>
                                    <field name="apply_stock" invisible="1"/>
                                    <field name="shipped" invisible="0"/>
                                </group>
                                <group>
                                    <field name="address_issued_id" readonly="1"/>
                                    <field name="company_emitter_id" readonly="1"/>
                                    <field name="origin" invisible="1" groups="base.group_user"/>
                                    <field name="name" string="Customer Reference"/>
                                    <div name="invoice_ref" attrs="{'invisible': [('invoice_id','=',False)]}" class="oe_inline">
                                        <label for="invoice_id" string="Factura Origen" attrs="{'invisible': [('type','!=','out_refund')]}" />
                                        <label for="invoice_id" string="Nota de Credito" attrs="{'invisible': [('type','=','out_refund')]}" />
                                    </div>
                                    <field name="invoice_id" nolabel="1" context="{'form_view_ref': 'account.invoice_form'}" attrs="{'invisible': [('invoice_id','=',False)]}" class="oe_inline"/>
                                    <field name="invoice_id2" string="Nota de cargo" context="{'form_view_ref': 'account.invoice_form'}" attrs="{'invisible': [('invoice_id2','=',False)]}" class="oe_inline"/>
                                    <field name="move_id" groups="account.group_account_user"/>
                                </group>
                            </group>
                            <field name="tax_line" attrs="{'readonly': [('filter_refund','not in',['none'])]}">
                                <tree editable="bottom" string="Taxes">
                                    <field name="name"/>
                                    <field name="account_id" groups="account.group_account_user"/>
                                    <field name="base" on_change="base_change(base,parent.currency_id,parent.company_id,parent.date_invoice)" readonly="1"/>
                                    <field name="amount" on_change="amount_change(amount,parent.currency_id,parent.company_id,parent.date_invoice)"/>
                                    <field invisible="True" name="base_amount"/>
                                    <field invisible="True" name="tax_amount"/>
                                    <field name="factor_base" invisible="True"/>
                                    <field name="factor_tax" invisible="True"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Payments" groups="base.group_user">
                            <field name="payment_ids">
                                <tree string="Payments">
                                    <field name="date"/>
                                    <field name="move_id"/>
                                    <field name="ref"/>
                                    <field name="name"/>
                                    <field name="journal_id" groups="base.group_user"/>
                                    <field name="debit"/>
                                    <field name="credit"/>
                                    <field name="amount_currency" groups="base.group_multi_currency"/>
                                    <field name="currency_id" groups="base.group_multi_currency"/>
                                    <button name="action_view_move" string="" type="object" icon="gtk-redo"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
                </form>
            </field>
        </record>
    
    </data>
</openerp>
